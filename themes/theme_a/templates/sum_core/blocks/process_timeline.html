{% load wagtailcore_tags %}

{% with steps_count=steps_count|default:self.steps|length highlight_index=highlight_index|default:0 %}
<section class="section py-20 lg:py-32 bg-sage-linen relative overflow-hidden"{% if section_id %} data-section-id="{{ section_id }}"{% endif %}>

    {# Background Decoration #}
    <div class="absolute top-0 right-0 w-1/3 h-full bg-sage-oat/20 -skew-x-12 translate-x-1/4 pointer-events-none" aria-hidden="true"></div>

    <div class="max-w-7xl mx-auto px-6 relative z-10">
        <div class="text-center max-w-3xl mx-auto mb-20 reveal">
            {% if self.eyebrow %}
                <span class="text-sage-terra font-accent italic text-xl block mb-3">{{ self.eyebrow }}</span>
            {% endif %}
            <h2 class="font-display text-4xl md:text-5xl lg:text-6xl text-sage-black mb-6">
                {{ self.heading|richtext }}
            </h2>
            {% if self.intro %}
                <div class="text-sage-black/70 font-light text-lg md:text-xl leading-relaxed">
                    {{ self.intro|richtext }}
                </div>
            {% endif %}
        </div>

        <div class="relative">
            {# Steps Container - Uses centered flex-wrap for perfect balance with any number of steps #}
            <div class="flex flex-wrap justify-center gap-6 lg:gap-10">
                {% for step in self.steps %}
                    {% if highlight_index and forloop.counter == highlight_index %}
                        {# HIGHLIGHTED CARD #}
                        <div class="w-full md:w-[calc(50%-1.5rem)] lg:w-[calc(33.333%-2rem)] xl:w-[calc(25%-2rem)] min-w-[280px] max-w-md flex-grow-0
                                    bg-sage-black text-sage-linen p-8 lg:p-10 rounded-2xl shadow-xl
                                    reveal delay-{{ forloop.counter0 }}00 relative group hover:-translate-y-2 transition-all duration-500 ease-smooth">

                            <div class="absolute -top-6 -right-6 w-24 h-24 bg-sage-terra/10 rounded-full blur-2xl group-hover:bg-sage-terra/20 transition-colors"></div>

                            <div class="relative z-10">
                                <span class="block text-5xl font-display text-sage-terra mb-6 opacity-90 group-hover:scale-110 transition-transform origin-left">
                                    {% if step.number %}
                                        {% if step.number < 10 %}0{% endif %}{{ step.number }}
                                    {% else %}
                                        {% if forloop.counter < 10 %}0{% endif %}{{ forloop.counter }}
                                    {% endif %}
                                </span>
                                <h3 class="font-bold text-sm uppercase tracking-widest text-white mb-4 border-l-2 border-sage-terra pl-3">{{ step.title }}</h3>
                                {% if step.description %}
                                    <div class="text-base text-sage-linen/80 leading-relaxed prose prose-invert">
                                        {{ step.description|richtext }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    {% else %}
                        {# STANDARD CARD #}
                        <div class="w-full md:w-[calc(50%-1.5rem)] lg:w-[calc(33.333%-2rem)] xl:w-[calc(25%-2rem)] min-w-[280px] max-w-md flex-grow-0
                                    bg-white text-sage-black p-8 lg:p-10 rounded-2xl border border-sage-black/5 shadow-sm hover:shadow-xl hover:shadow-sage-black/5
                                    reveal delay-{{ forloop.counter0 }}00 relative group hover:-translate-y-2 transition-all duration-500 ease-smooth">

                            <span class="absolute top-6 right-8 text-6xl font-display text-sage-oat/50 group-hover:text-sage-terra/20 transition-colors duration-500 select-none">
                                {% if step.number %}
                                    {% if step.number < 10 %}0{% endif %}{{ step.number }}
                                {% else %}
                                    {% if forloop.counter < 10 %}0{% endif %}{{ forloop.counter }}
                                {% endif %}
                            </span>

                            <div class="relative z-10 pt-4">
                                <h3 class="font-bold text-sm uppercase tracking-widest text-sage-black mb-4 border-l-2 border-sage-terra/50 pl-3 group-hover:border-sage-terra transition-colors">{{ step.title }}</h3>
                                {% if step.description %}
                                    <div class="text-base text-sage-black/70 leading-relaxed">
                                        {{ step.description|richtext }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>

        {% if self.cta_link %}
            <div class="text-center mt-20 reveal delay-500">
                <a href="{{ self.cta_link.href }}" {{ self.cta_link.attrs_str }} class="btn btn-primary">
                    {% if self.cta_label %}
                        {{ self.cta_label }}
                    {% else %}
                        {{ self.cta_link.text }}
                    {% endif %}
                </a>
            </div>
        {% endif %}
    </div>
</section>
{% endwith %}
