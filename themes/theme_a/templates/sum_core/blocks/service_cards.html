{% load wagtailcore_tags wagtailimages_tags %}

<section class="{% if self.variant == 'proof_grid' %}py-24 bg-sage-linen{% else %}py-20 bg-sage-oat/30{% endif %}"{% if section_id %} data-section-id="{{ section_id }}"{% endif %}>
    <div class="max-w-7xl mx-auto px-6">
        {% if self.variant == "proof_grid" %}
            <div class="mb-12">
                {% if self.eyebrow %}
                    <span class="text-sage-terra font-accent italic text-xl block mb-2">{{ self.eyebrow }}</span>
                {% endif %}
                {% if self.heading %}
                    <h2 class="font-display text-4xl md:text-5xl text-sage-black">{{ self.heading|striptags }}</h2>
                {% endif %}
            </div>
        {% else %}
            {# Header Area - Only render if content exists #}
            {% if self.eyebrow or self.heading or self.intro %}
            <div class="mb-12 max-w-3xl">
                {% if self.eyebrow %}
                    <span class="block text-xs font-bold uppercase tracking-widest text-sage-moss mb-4">{{ self.eyebrow }}</span>
                {% endif %}

                {% if self.heading %}
                    <div class="font-display text-4xl md:text-5xl text-sage-black mb-6 leading-tight">
                        {{ self.heading|richtext }}
                    </div>
                {% endif %}

                {% if self.intro %}
                    <p class="text-sage-black font-light leading-relaxed text-lg">{{ self.intro }}</p>
                {% endif %}
            </div>
            {% endif %}
        {% endif %}

        {% if self.variant == "default" %}
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                {% for card in self.cards %}
                    <div class="group relative border border-sage-black/10 bg-white/80 flex flex-col justify-between p-10 hover:bg-white transition-colors duration-500 reveal min-h-[320px]">
                        <div class="mb-6">
                            {% if card.kicker %}
                                <span class="block text-xs font-bold uppercase tracking-widest text-sage-meta mb-4">
                                    {{ card.kicker }}
                                </span>
                            {% endif %}

                            <h3 class="font-display text-2xl text-sage-black mb-4 group-hover:text-sage-terra transition-colors">
                                {{ card.title }}
                            </h3>

                            {% if card.image %}
                                <div class="mb-6 w-full aspect-[4/3] overflow-hidden bg-sage-black/5">
                                    {% image card.image fill-400x300 class="w-full h-full object-cover transition-transform duration-700" %}
                                </div>
                            {% elif card.icon %}
                                <div class="mb-4 text-3xl text-sage-terra">
                                    {{ card.icon }}
                                </div>
                            {% endif %}

                            {% if card.description %}
                                <div class="text-sage-black font-light leading-relaxed prose prose-sm prose-p:text-sage-black prose-a:text-sage-terra">
                                    {{ card.description|richtext }}
                                </div>
                            {% endif %}
                        </div>
                        <div>
                            {% if card.link_url %}
                                {% with link=card.link_url %}
                                <a href="{{ link.href }}" {{ link.attrs_str }} class="inline-block text-xs font-bold uppercase tracking-widest border-b border-sage-black/20 pb-1 group-hover:border-sage-terra transition-colors py-2">
                                    {{ card.link_label|default:"Learn More" }}
                                </a>
                                {% endwith %}
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% elif self.variant == "proof_grid" %}
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                {% for card in self.cards %}
                    {% with link=card.link_url %}
                        {% if link %}
                            <a href="{{ link.href }}" {{ link.attrs_str }} class="block group focus:outline-none focus:ring-2 focus:ring-sage-terra focus:ring-offset-2 rounded-sm">
                        {% else %}
                            <div class="block group">
                        {% endif %}
                            <div class="aspect-square bg-sage-oat overflow-hidden mb-4 relative">
                                {% if card.image %}
                                    {% image card.image fill-600x600 class="w-full h-full object-cover transition-transform duration-700" %}
                                {% endif %}
                                {% if card.kicker %}
                                    <div class="absolute bottom-4 left-4 bg-white/90 backdrop-blur px-3 py-1 text-xs font-bold uppercase tracking-widest text-sage-black group-hover:text-sage-terra transition-colors">
                                        {{ card.kicker }}
                                    </div>
                                {% endif %}
                            </div>
                            <h3 class="font-display text-xl text-sage-black mb-2 group-hover:text-sage-terra transition-colors">{{ card.title }}</h3>
                            {% if card.description %}
                                <p class="text-base text-sage-label">{{ card.description|striptags }}</p>
                            {% endif %}
                        {% if link %}
                            </a>
                        {% else %}
                            </div>
                        {% endif %}
                    {% endwith %}
                {% endfor %}
            </div>
        {% else %}
            {# Featured grid variant #}
            <div class="grid grid-cols-1 md:grid-cols-3 gap-0 border border-sage-black/10">
                {% for card in self.cards %}
                    {% if card.is_featured or forloop.first %}
                        <div class="md:col-span-2 group relative border-b md:border-b-0 md:border-r border-sage-black/10 flex flex-col justify-between p-12 hover:bg-white transition-colors duration-500 reveal min-h-[400px]">
                            <div class="mb-8">
                                <span class="block text-xs font-bold uppercase tracking-widest text-sage-moss mb-4">
                                    {% if card.icon %}{{ card.icon }} {% endif %}
                                    {{ card.kicker|default:"Featured Service" }}
                                </span>

                                <h3 class="font-display text-4xl text-sage-black mb-2 group-hover:text-sage-terra transition-colors">
                                    {{ card.title }}
                                </h3>

                                {% if card.price_range %}
                                    <span class="block font-display text-xs text-sage-black/60 mb-6">{{ card.price_range }}</span>
                                {% endif %}

                                {% if card.image %}
                                    <div class="mb-6 w-full aspect-video overflow-hidden bg-sage-black/5">
                                        {% image card.image fill-800x450 class="w-full h-full object-cover transition-transform duration-700" %}
                                    </div>
                                {% endif %}

                                {% if card.description %}
                                    <div class="text-sage-black font-light leading-relaxed text-lg max-w-xl prose prose-p:text-sage-black prose-a:text-sage-terra">
                                        {{ card.description|richtext }}
                                    </div>
                                {% endif %}
                            </div>
                            <div>
                                {% if card.link_url %}
                                    {% with link=card.link_url %}
                                    <a href="{{ link.href }}" {{ link.attrs_str }} class="inline-flex items-center text-xs font-bold uppercase tracking-widest border-b-2 border-sage-black/20 pb-2 hover:border-sage-terra hover:text-sage-terra transition-colors py-2">
                                        {{ card.link_label|default:"Explore Process" }}
                                        <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
                                    </a>
                                    {% endwith %}
                                {% else %}
                                    <div class="inline-flex items-center text-xs font-bold uppercase tracking-widest border-b-2 border-transparent pb-2 text-sage-black/40 cursor-default">
                                        {{ card.link_label|default:"Coming Soon" }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    {% else %}
                        <div class="group relative border-b md:border-b-0 border-sage-black/10 flex flex-col justify-between p-12 hover:bg-white transition-colors duration-500 reveal min-h-[400px] {% if forloop.last %}md:border-r{% endif %}">
                            <div class="mb-8">
                                <span class="block text-xs font-bold uppercase tracking-widest text-sage-meta mb-4">
                                    {% if card.kicker %}
                                        {{ card.kicker }}
                                    {% else %}
                                        {{ forloop.counter0|stringformat:"02d" }}
                                    {% endif %}
                                </span>

                                <h3 class="font-display text-3xl text-sage-black mb-4 group-hover:text-sage-terra transition-colors">
                                    {{ card.title }}
                                </h3>

                                {% if card.price_range %}
                                    <span class="block text-xs uppercase tracking-widest text-sage-meta mb-4">{{ card.price_range }}</span>
                                {% endif %}

                                {% if card.image %}
                                    <div class="mb-6 w-full aspect-[4/3] overflow-hidden bg-sage-black/5">
                                        {% image card.image fill-400x300 class="w-full h-full object-cover transition-transform duration-700" %}
                                    </div>
                                {% elif card.icon %}
                                    <div class="mb-4 text-3xl text-sage-terra">
                                        {{ card.icon }}
                                    </div>
                                {% endif %}

                                {% if card.description %}
                                    <div class="text-sage-black font-light leading-relaxed prose prose-sm prose-p:text-sage-black prose-a:text-sage-terra">
                                        {{ card.description|richtext }}
                                    </div>
                                {% endif %}
                            </div>
                            <div>
                                {% if card.link_url %}
                                    {% with link=card.link_url %}
                                    <a href="{{ link.href }}" {{ link.attrs_str }} class="inline-block text-xs font-bold uppercase tracking-widest border-b border-sage-black/20 pb-1 group-hover:border-sage-terra transition-colors py-2">
                                        {{ card.link_label|default:"Learn More" }}
                                    </a>
                                    {% endwith %}
                                {% endif %}
                            </div>
                        </div>
                    {% endif %}
                {% endfor %}

                {% if self.supporting_image %}
                    <div class="md:col-span-2 relative overflow-hidden min-h-[400px] reveal">
                        {% image self.supporting_image fill-1200x900 class="absolute inset-0 w-full h-full object-cover transition-transform duration-1000" alt=self.alt_text|default:self.heading|striptags %}
                    </div>
                {% endif %}
            </div>
        {% endif %}

        {% if self.view_all_link %}
            <div class="mt-12 text-center">
                {% with link=self.view_all_link %}
                <a href="{{ link.href }}" {{ link.attrs_str }} class="inline-block text-xs font-bold uppercase tracking-widest border-b border-sage-black/20 pb-1 hover:border-sage-terra hover:text-sage-terra transition-colors py-2">
                    {{ self.view_all_label|default:"View All Services" }}
                </a>
                {% endwith %}
            </div>
        {% endif %}
    </div>
</section>
